{% extends layout %}
{% block page_body %}

    <h1>标注任务</h1>

    <div class="form-group">
        <label for="file">标注数据集合：</label>
        <input type="file" id="file" name="file">
    </div>

    <div class="form-group">
        <label>标注方式：</label>
        <div>
            <input type="checkbox" id="judgment" name="annotationType" value="判断标注">
            <label class="checkbox-label" for="judgment">判断标注</label>
        </div>
        <div>
            <input type="checkbox" id="sorting" name="annotationType" value="排序标注">
            <label class="checkbox-label" for="sorting">排序标注</label>
        </div>
        <div>
            <input type="checkbox" id="boundingBox" name="annotationType" value="框选标注">
            <label class="checkbox-label" for="boundingBox">框选标注</label>
        </div>
    </div>

    <div class="form-group">
        <label for="deadline">截止时间：</label>
        <input type="datetime-local" id="deadline" name="deadline">
    </div>

    <div class="form-group">
        <label>任务分配：</label>
        <table>
            <thead>
                <tr>
                    <th>标注员</th>
                    <th>题目数量</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>标注员1</td>
                    <td>10</td>
                </tr>
                <tr>
                    <td>标注员2</td>
                    <td>15</td>
                </tr>
                <tr>
                    <td>标注员3</td>
                    <td>20</td>
                </tr>
            </tbody>
        </table>
    </div>

    <button type="submit" onclick="submitForm()">提交</button>

    <script>
        function submitForm() {
    var fileInput = document.getElementById('file');
    var file = fileInput.files[0];
    var reader = new FileReader();
    var fileName = file.name; // 获取文件的路径

    // 读取文件内容
    reader.onload = function(e) {
        var fileContent = e.target.result;
        // 在这里对文件内容进行处理
        console.log(fileContent);

        var annotationTypes = [];
        var checkboxes = document.getElementsByName('annotationType');
        for (var i = 0; i < checkboxes.length; i++) {
            if (checkboxes[i].checked) {
                annotationTypes.push(checkboxes[i].value);
            }
        }

        var deadlineInput = document.getElementById('deadline');
        var deadline = deadlineInput.value;

        var tableRows = document.querySelectorAll('table tbody tr');
        var taskAssignments = [];
        for (var i = 0; i < tableRows.length; i++) {
            var cells = tableRows[i].querySelectorAll('td');
            var annotator = cells[0].textContent;
            var taskCount = cells[1].textContent;
            taskAssignments.push({ annotator: annotator, taskCount: taskCount });
        }

        var formData = {
            fileName: fileName,
            fileContent: fileContent, // 将文件内容添加到表单数据中
            annotationTypes: annotationTypes,
            deadline: deadline,
            taskAssignments: taskAssignments
        };

        // 调用回调函数，将数据传递给它进行处理
        // 使用 $.ajax 发送数据到特定的 URL
        $.ajax({
            type: 'POST',
            url: '/admin/taskmanage/create_task_callback',
            data: JSON.stringify(formData),
            contentType: 'application/json',
            success: function(response) {
                // 请求成功的处理
                history.back();
                location.href='/admin/taskmanage/list';

                // alert(success);
            },
            error: function(error) {
                // 请求失败的处理
                console.log(error);
            }
        });
    };

    // 以文本格式读取文件内容
    reader.readAsText(file);
}

    </script>
</body>

{% endblock %}
